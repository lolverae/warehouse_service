version: '3.0'

services:
  web:
    image: warehouse
    build:
      context: ./app
      #      args: 
      # port:${APP_PORT} 
    ports: 
      - "${APP_PORT}:8000"
    env_file:
      - .env
    restart: always
    networks:
      - warehouse-net
    command: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
    
#    deploy:
#      replicas: 2
#      update_config:
#        parallelism: 2
#        delay: 10s
#      restart_policy:
#        condition: always 
  couch:
    image: couchdb
    volumes:
      - db-data:/var/lib/couchdb/data
    env_file:
      - .env
    restart: always
    networks:
      - warehouse-net
#    ports:
#     - "5984:5984"
#    deploy:
#      replicas: 2
#      update_config:
#        parallelism: 2
#        delay: 10s
#      restart_policy:
#        condition: always

networks:
  warehouse-net:
volumes:
  db-data:
